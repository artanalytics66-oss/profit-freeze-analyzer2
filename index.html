<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profit Freeze Analyzer Pro | Terminal Mode</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            /* Строгая палитра "Fintech Dark" */
            --bg-body: #0F1115;       /* Почти черный фон */
            --bg-card: #181B21;       /* Темно-серые панели */
            --bg-input: #0F1115;      /* Фон полей ввода */
            
            --text-primary: #E1E3E6;  /* Белый текст */
            --text-secondary: #8B949E;/* Серый текст */
            
            --accent-green: #00E676;  /* Биржевой зеленый */
            --accent-red: #FF4444;    /* Биржевой красный */
            --accent-blue: #2979FF;   /* Строгий синий */
            --border-color: #2D333B;  /* Границы */
            
            --font-main: 'Inter', system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', 'Roboto Mono', monospace; /* Для цифр */
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-body);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 320px 1fr 320px;
            gap: 20px;
            min-height: 90vh;
        }

        /* Стиль панелей - "Терминал" */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 4px; /* Строгие углы */
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        h1 {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin: 0 0 20px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        h2 {
            font-size: 12px;
            color: var(--accent-blue);
            margin: 20px 0 10px 0;
            font-weight: 600;
        }
        h2:first-of-type { margin-top: 0; }

        /* Поля ввода - строгие */
        .input-group { margin-bottom: 12px; }
        .input-group label {
            display: block;
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        .input-group input {
            width: 100%;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 2px;
            font-family: var(--font-mono);
            font-size: 13px;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }
        .input-group input:focus {
            border-color: var(--accent-blue);
            outline: none;
        }

        /* KPI Карточки - "Тикеры" */
        .kpi-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .kpi-label {
            font-size: 11px;
            color: var(--text-secondary);
        }
        .kpi-value {
            font-family: var(--font-mono);
            font-size: 18px;
            font-weight: 600;
        }
        .val-green { color: var(--accent-green); }
        .val-red { color: var(--accent-red); }
        .val-neutral { color: var(--text-primary); }

        /* График */
        .chart-container {
            flex-grow: 1;
            position: relative;
            min-height: 400px;
            background: #131519; /* Чуть темнее для контраста */
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 10px;
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .badge {
            background: rgba(41, 121, 255, 0.1);
            color: var(--accent-blue);
            border: 1px solid rgba(41, 121, 255, 0.3);
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 2px;
            text-transform: uppercase;
        }

        /* AI Блок - "Консоль" */
        .ai-advisor {
            margin-top: 20px;
            background: #131519;
            border: 1px solid var(--border-color);
            border-left: 3px solid var(--accent-blue);
            padding: 15px;
            font-family: var(--font-mono);
            font-size: 12px;
            line-height: 1.6;
        }
        .ai-title {
            color: var(--accent-blue);
            font-weight: bold;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        /* Адаптив */
        @media (max-width: 1200px) {
            .container { grid-template-columns: 1fr; height: auto; }
            .card { min-height: auto; }
        }
    </style>
</head>
<body>

<div class="container">
    
    <!-- ЛЕВАЯ ПАНЕЛЬ: ВВОД -->
    <div class="card">
        <h1>Параметры / Input</h1>
        
        <h2>LOGISTICS & PURCHASE</h2>
        <div class="input-group"><label>Сумма закупки (RUB)</label><input type="number" id="purchaseCost" value="1000000" oninput="calculate()"></div>
        <div class="input-group"><label>Объем (PLT)</label><input type="number" id="pallets" value="10" oninput="calculate()"></div>
        <div class="input-group"><label>Отсрочка (Days)</label><input type="number" id="deferment" value="14" oninput="calculate()"></div>

        <h2>MARKET & SALES</h2>
        <div class="input-group"><label>Наценка (%)</label><input type="number" id="markupPercent" value="25" oninput="calculate()"></div>
        <div class="input-group"><label>Скорость (PLT/Day)</label><input type="number" id="salesSpeed" value="0.3" step="0.1" oninput="calculate()"></div>

        <h2>OPEX & RATES</h2>
        <div class="input-group"><label>Хранение (RUB/PLT/Day)</label><input type="number" id="storageCost" value="150" oninput="calculate()"></div>
        <div class="input-group"><label>Стоимость денег (% Year)</label><input type="number" id="moneyCost" value="22" oninput="calculate()"></div>
    </div>

    <!-- ЦЕНТР: ГРАФИК -->
    <div class="card">
        <div class="chart-header">
            <h1>PnL Simulation</h1>
            <span class="badge">Live Data</span>
        </div>
        <div class="chart-container">
            <canvas id="profitChart"></canvas>
        </div>
        
        <!-- AI БЛОК -->
        <div class="ai-advisor">
            <div class="ai-title">> SYSTEM ANALYSIS:</div>
            <div id="aiOutput">Calculating...</div>
        </div>
    </div>

    <!-- ПРАВАЯ ПАНЕЛЬ: ВЕРДИКТ -->
    <div class="card">
        <h1>Summary / Output</h1>
        
        <div class="kpi-row">
            <span class="kpi-label">MAX PROFIT</span>
            <span class="kpi-value val-neutral" id="maxProfit">0</span>
        </div>
        
        <div class="kpi-row">
            <span class="kpi-label">NET PROFIT</span>
            <span class="kpi-value" id="realProfit">0</span>
        </div>
        
        <div class="kpi-row">
            <span class="kpi-label">BREAK-EVEN (ZERO)</span>
            <span class="kpi-value val-red" id="zeroPoint">0</span>
        </div>

        <div class="kpi-row">
            <span class="kpi-label">ROI (ANNUALIZED)</span>
            <span class="kpi-value" id="roiYear">0%</span>
        </div>

        <div class="kpi-row" style="border-bottom: none;">
            <span class="kpi-label">SALES CYCLE</span>
            <span class="kpi-value val-neutral" id="sellDays">0</span>
        </div>
        
        <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border-color); font-size: 11px; color: var(--text-secondary); line-height: 1.4;">
            STATUS: <span id="statusIndicator" style="color: var(--accent-green)">ACTIVE</span><br>
            VERSION: 2.1.0 PRO
        </div>
    </div>

</div>

<script>
    let chartInstance = null;

    function calculate() {
        const P_buy = parseFloat(document.getElementById('purchaseCost').value) || 0;
        const Q_pallets = parseFloat(document.getElementById('pallets').value) || 1;
        const Deferment = parseFloat(document.getElementById('deferment').value) || 0;
        const Markup = parseFloat(document.getElementById('markupPercent').value) / 100;
        const Speed = parseFloat(document.getElementById('salesSpeed').value) || 0.1;
        const Cost_storage = parseFloat(document.getElementById('storageCost').value) || 0;
        const Rate_money = parseFloat(document.getElementById('moneyCost').value) / 100 / 365;

        const Gross_Margin = P_buy * Markup;
        const Days_to_sell = Q_pallets / Speed;

        const days = [];
        const profits = [];
        let zeroDay = null;
        let currentProfit = Gross_Margin;
        let totalCost = 0;

        for (let d = 0; d <= Math.max(Days_to_sell * 1.5, 90); d++) {
            let stock_remains = Math.max(0, Q_pallets - (d * Speed));
            let day_storage = stock_remains * Cost_storage;
            let money_frozen = (stock_remains / Q_pallets) * P_buy; 
            let day_money = (d > Deferment) ? money_frozen * Rate_money : 0;

            totalCost += (day_storage + day_money);
            currentProfit = Gross_Margin - totalCost;

            days.push(d);
            profits.push(currentProfit);
            if (currentProfit <= 0 && zeroDay === null) zeroDay = d;
        }

        const sellDayIndex = Math.min(Math.floor(Days_to_sell), days.length - 1);
        const Final_Profit = profits[sellDayIndex] || -totalCost;
        const ROI = (Final_Profit / P_buy) * 100;
        const ROI_Year = (ROI / Days_to_sell) * 365;

        // Форматирование цифр "как в терминале"
        const fmt = (num) => Math.round(num).toLocaleString('ru-RU');

        document.getElementById('maxProfit').innerText = fmt(Gross_Margin);
        document.getElementById('realProfit').innerText = fmt(Final_Profit);
        document.getElementById('realProfit').className = 'kpi-value ' + (Final_Profit > 0 ? 'val-green' : 'val-red');
        
        document.getElementById('zeroPoint').innerText = (zeroDay || '>365') + ' d';
        document.getElementById('roiYear').innerText = isFinite(ROI_Year) ? Math.round(ROI_Year) + '%' : '0%';
        document.getElementById('roiYear').className = 'kpi-value ' + (ROI_Year > 20 ? 'val-green' : 'val-red');
        
        document.getElementById('sellDays').innerText = Math.round(Days_to_sell) + ' d';

        updateChart(days, profits);
        generateAIAdvice(Final_Profit, ROI_Year, Days_to_sell, Deferment, zeroDay);
    }

    function updateChart(labels, data) {
        const ctx = document.getElementById('profitChart').getContext('2d');
        if (chartInstance) chartInstance.destroy();
        
        // Градиент для графика
        let gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(0, 230, 118, 0.2)');
        gradient.addColorStop(1, 'rgba(0, 230, 118, 0)');

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Net Profit',
                    data: data,
                    borderColor: '#00E676', // Зеленый неон
                    backgroundColor: gradient,
                    borderWidth: 2,
                    fill: true,
                    pointRadius: 0,
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: {display: false},
                    annotation: { annotations: { line1: { type: 'line', yMin: 0, yMax: 0, borderColor: '#FF4444', borderWidth: 1, borderDash: [4, 4] } } }
                },
                scales: { 
                    x: { grid: {color: '#2D333B'}, ticks: {color: '#8B949E'} }, 
                    y: { grid: {color: '#2D333B'}, ticks: {color: '#8B949E'} } 
                },
                interaction: {
                    mode: 'index',
                    intersect: false,
                }
            }
        });
    }

    function generateAIAdvice(profit, roi, daysSell, deferment, zeroDay) {
        const el = document.getElementById('aiOutput');
        let lines = [];

        if (profit < 0) lines.push("[CRITICAL] DEAL IS UNPROFITABLE. IMMEDIATE ACTION REQUIRED.");
        else if (roi < 20) lines.push("[WARNING] LOW ROI DETECTED. CONSIDER ALTERNATIVE INVESTMENT.");
        else lines.push("[OK] ROI IS HEALTHY. PROCEED WITH CAUTION.");

        if (daysSell > deferment) {
            const gap = Math.round(daysSell - deferment);
            lines.push(`[ALERT] CASH GAP DETECTED: ${gap} DAYS. LIQUIDITY RISK.`);
        } else {
            lines.push("[OK] CASH FLOW POSITIVE. SALES CYCLE WITHIN DEFERMENT LIMIT.");
        }

        if (zeroDay && zeroDay < daysSell * 1.2) {
             lines.push(`[INFO] ZERO-PROFIT POINT AT DAY ${zeroDay}. MARGIN EROSION RISK HIGH.`);
        }

        el.innerHTML = lines.join("<br>> ");
    }

    window.onload = calculate;
</script>

</body>
</html>



