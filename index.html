<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profit Freeze Analyzer 2.0 | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #F0F2F5;
            --card-bg: #FFFFFF;
            --primary: #2563EB;
            --danger: #DC2626;
            --success: #10B981;
            --text-main: #1F2937;
            --text-sec: #6B7280;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: var(--text-main);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 350px 1fr 300px;
            gap: 24px;
            height: 90vh;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        h1 { font-size: 20px; font-weight: 700; margin-bottom: 24px; display: flex; align-items: center; gap: 10px; }
        h2 { font-size: 16px; font-weight: 600; color: var(--text-sec); margin-bottom: 16px; margin-top: 24px; border-bottom: 1px solid #E5E7EB; padding-bottom: 8px;}
        h2:first-child { margin-top: 0; }

        /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
        .input-group { margin-bottom: 16px; }
        .input-group label { display: block; font-size: 13px; color: var(--text-sec); margin-bottom: 6px; }
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
            box-sizing: border-box;
        }
        .input-group input:focus { border-color: var(--primary); outline: none; }

        /* –î–∞—à–±–æ—Ä–¥ —Å–ø—Ä–∞–≤–∞ */
        .kpi-card {
            background: #F9FAFB;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            text-align: center;
            border-left: 4px solid var(--primary);
        }
        .kpi-card.danger { border-left-color: var(--danger); background: #FEF2F2; }
        .kpi-card.success { border-left-color: var(--success); background: #ECFDF5; }
        
        .kpi-value { font-size: 28px; font-weight: 800; display: block; margin: 8px 0; }
        .kpi-label { font-size: 13px; color: var(--text-sec); text-transform: uppercase; letter-spacing: 0.5px; }
        .kpi-sub { font-size: 12px; color: var(--text-sec); }

        /* –ì—Ä–∞—Ñ–∏–∫ */
        .chart-container { position: relative; height: 100%; min-height: 400px; display: flex; flex-direction: column; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .badge { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge-live { background: #DBEAFE; color: var(--primary); }

        /* –ê–¥–∞–ø—Ç–∏–≤ */
        @media (max-width: 1024px) {
            .container { grid-template-columns: 1fr; height: auto; }
        }
    </style>
</head>
<body>

<div class="container">
    
    <!-- 1. –ü–ê–ù–ï–õ–¨ –í–í–û–î–ê –î–ê–ù–ù–´–• -->
    <div class="card">
        <h1>‚ùÑÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –°–¥–µ–ª–∫–∏</h1>
        
        <h2>üì¶ –ü–∞—Ä—Ç–∏—è –∏ –ó–∞–∫—É–ø–∫–∞</h2>
        <div class="input-group">
            <label>–°—É–º–º–∞ –∑–∞–∫—É–ø–∫–∏ (–ø–∞—Ä—Ç–∏—è), —Ä—É–±.</label>
            <input type="number" id="purchaseCost" value="1000000" oninput="calculate()">
        </div>
        <div class="input-group">
            <label>–û–±—ä–µ–º –ø–∞—Ä—Ç–∏–∏ (–ø–∞–ª–ª–µ—Ç)</label>
            <input type="number" id="pallets" value="10" oninput="calculate()">
        </div>
        <div class="input-group">
            <label>–û—Ç—Å—Ä–æ—á–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫—É (–¥–Ω–µ–π)</label>
            <input type="number" id="deferment" value="14" oninput="calculate()">
        </div>

        <h2>üí∞ –ü—Ä–æ–¥–∞–∂–∏ –∏ –†—ã–Ω–æ–∫</h2>
        <div class="input-group">
            <label>–ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –Ω–∞—Ü–µ–Ω–∫–∞ (%)</label>
            <input type="number" id="markupPercent" value="25" oninput="calculate()">
        </div>
        <div class="input-group">
            <label>–°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂ (–ø–∞–ª–ª–µ—Ç –≤ –¥–µ–Ω—å)</label>
            <input type="number" id="salesSpeed" value="0.3" step="0.1" oninput="calculate()">
        </div>

        <h2>üìâ –†–∞—Å—Ö–æ–¥—ã —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è</h2>
        <div class="input-group">
            <label>–•—Ä–∞–Ω–µ–Ω–∏–µ (—Ä—É–± / –ø–∞–ª–ª–µ—Ç / —Å—É—Ç–∫–∏)</label>
            <input type="number" id="storageCost" value="150" oninput="calculate()">
        </div>
        <div class="input-group">
            <label>–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–µ–Ω–µ–≥ (–∫—Ä–µ–¥–∏—Ç/–∫–∞–ø–∏—Ç–∞–ª, % –≥–æ–¥)</label>
            <input type="number" id="moneyCost" value="22" oninput="calculate()">
        </div>
    </div>

    <!-- 2. –¶–ï–ù–¢–†–ê–õ–¨–ù–´–ô –ì–†–ê–§–ò–ö -->
    <div class="card chart-container">
        <div class="chart-header">
            <h1>–î–∏–Ω–∞–º–∏–∫–∞ "–¢–∞—è–Ω–∏—è" –ü—Ä–∏–±—ã–ª–∏</h1>
            <span class="badge badge-live">Live Simulation</span>
        </div>
        <div style="flex-grow: 1; position: relative;">
            canvas id="profitChart"></canvas>
        </div>
        <p style="font-size: 13px; color: #666; margin-top: 15px; text-align: center;">
            –ì—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ –¥–µ–Ω—å–≥–∏ "—Å—ä–µ–¥–∞—é—Ç" –≤–∞—à—É –Ω–∞—á–∞–ª—å–Ω—É—é –Ω–∞—Ü–µ–Ω–∫—É.
        </p>
    </div>

    <!-- 3. –ò–¢–û–ì–û–í–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê -->
    <div class="card">
        <h1>üéØ –í–µ—Ä–¥–∏–∫—Ç</h1>

        <div class="kpi-card success">
            <span class="kpi-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ü—Ä–∏–±—ã–ª—å</span>
            <span class="kpi-value" id="maxProfit">0 ‚ÇΩ</span>
            <span class="kpi-sub">–ï—Å–ª–∏ –ø—Ä–æ–¥–∞–¥–∏–º –º–≥–Ω–æ–≤–µ–Ω–Ω–æ</span>
        </div>

        <div class="kpi-card">
            <span class="kpi-label">–†–µ–∞–ª—å–Ω–∞—è –ü—Ä–∏–±—ã–ª—å</span>
            <span class="kpi-value" id="realProfit">0 ‚ÇΩ</span>
            <span class="kpi-sub">–° —É—á–µ—Ç–æ–º —Å—Ä–æ–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏</span>
        </div>

        <div class="kpi-card danger">
            <span class="kpi-label">–¢–æ—á–∫–∞ "–°–º–µ—Ä—Ç–∏" (–ù–æ–ª—å)</span>
            <span class="kpi-value" id="zeroPoint">0 –¥–Ω.</span>
            <span class="kpi-sub">–ß–µ—Ä–µ–∑ —Å—Ç–æ–ª—å–∫–æ –¥–Ω–µ–π –ø—Ä–∏–±—ã–ª—å –∏—Å—á–µ–∑–Ω–µ—Ç</span>
        </div>
        
        <div class="kpi-card">
            <span class="kpi-label">–≠—Ñ—Ñ. –≥–æ–¥–æ–≤—ã—Ö (ROI)</span>
            <span class="kpi-value" id="roiYear">0%</span>
            <span class="kpi-sub">–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å —Å–¥–µ–ª–∫–∏</span>
        </div>

        <div style="margin-top: 20px; font-size: 12px; color: #888; line-height: 1.4;">
            üí° <b>–°–æ–≤–µ—Ç:</b> –ï—Å–ª–∏ "–¢–æ—á–∫–∞ —Å–º–µ—Ä—Ç–∏" –º–µ–Ω—å—à–µ –≤–∞—à–µ–≥–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø—Ä–æ–¥–∞–∂ ‚Äî –æ—Ç–∫–∞–∂–∏—Ç–µ—Å—å –æ—Ç –∑–∞–∫—É–ø–∫–∏ –∏–ª–∏ —Ç—Ä–µ–±—É–π—Ç–µ —Å–∫–∏–¥–∫—É.
        </div>
    </div>

</div>

<script>
    let chartInstance = null;

    function calculate() {
        // 1. –°—á–∏—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        const P_buy = parseFloat(document.getElementById('purchaseCost').value); // –ó–∞–∫—É–ø–∫–∞
        const Q_pallets = parseFloat(document.getElementById('pallets').value); // –ü–∞–ª–ª–µ—Ç
        const Deferment = parseFloat(document.getElementById('deferment').value); // –û—Ç—Å—Ä–æ—á–∫–∞
        const Markup = parseFloat(document.getElementById('markupPercent').value) / 100; // –ù–∞—Ü–µ–Ω–∫–∞
        const Speed = parseFloat(document.getElementById('salesSpeed').value); // –°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂
        const Cost_storage = parseFloat(document.getElementById('storageCost').value); // –•—Ä–∞–Ω–µ–Ω–∏–µ
        const Rate_money = parseFloat(document.getElementById('moneyCost').value) / 100 / 365; // –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–µ–Ω–µ–≥ –≤ –¥–µ–Ω—å

        // 2. –†–∞—Å—á–µ—Ç –±–∞–∑–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
        const P_sell = P_buy * (1 + Markup); // –°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂–∏
        const Gross_Margin = P_sell - P_buy; // –ì—Ä—è–∑–Ω–∞—è –ø—Ä–∏–±—ã–ª—å
        const Days_to_sell = Q_pallets / Speed; // –î–Ω–µ–π –Ω–∞ –ø–æ–ª–Ω—É—é –ø—Ä–æ–¥–∞–∂—É

        // 3. –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–Ω—è–º (–º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞)
        const days = [];
        const profits = [];
        const costs = [];
        
        let currentProfit = Gross_Margin;
        let totalCost = 0;
        let zeroDay = null;

        // –°—á–∏—Ç–∞–µ–º –Ω–∞ 365 –¥–Ω–µ–π –≤–ø–µ—Ä–µ–¥ –∏–ª–∏ –¥–æ –≥–ª—É–±–æ–∫–æ–≥–æ –º–∏–Ω—É—Å–∞
        for (let d = 0; d <= Math.max(Days_to_sell * 1.5, 90); d++) {
            // –†–∞—Å—Ö–æ–¥—ã –∑–∞ –¥–µ–Ω—å d
            // –•—Ä–∞–Ω–µ–Ω–∏–µ: –ø–ª–∞—Ç–∏–º —Ç–æ–ª—å–∫–æ –∑–∞ –æ—Å—Ç–∞—Ç–æ–∫ —Ç–æ–≤–∞—Ä–∞
            let stock_remains = Math.max(0, Q_pallets - (d * Speed));
            let day_storage = stock_remains * Cost_storage; // –ï—Å–ª–∏ –ø—Ä–æ–¥–∞–ª–∏ –≤—Å—ë, —Ö—Ä–∞–Ω–µ–Ω–∏–µ 0

            // –î–µ–Ω—å–≥–∏: –ø–ª–∞—Ç–∏–º % –Ω–∞ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—É—é —Å—É–º–º—É (–µ—Å–ª–∏ –∫–æ–Ω—á–∏–ª–∞—Å—å –æ—Ç—Å—Ä–æ—á–∫–∞)
            let money_frozen = (stock_remains / Q_pallets) * P_buy; 
            let day_money = (d > Deferment) ? money_frozen * Rate_money : 0;

            let day_total_loss = day_storage + day_money;
            totalCost += day_total_loss;
            currentProfit = Gross_Margin - totalCost;

            days.push(d);
            profits.push(currentProfit);
            
            // –õ–æ–≤–∏–º —Ç–æ—á–∫—É –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –Ω—É–ª—è
            if (currentProfit <= 0 && zeroDay === null) {
                zeroDay = d;
            }
        }

        // 4. –†–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–ª–Ω–æ–π —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∏
        // –ò–Ω–¥–µ–∫—Å –¥–Ω—è, –∫–æ–≥–¥–∞ –≤—Å–µ –ø—Ä–æ–¥–∞–¥–∏–º (–æ–∫—Ä—É–≥–ª—è–µ–º)
        const sellDayIndex = Math.min(Math.floor(Days_to_sell), days.length - 1);
        const Final_Profit = profits[sellDayIndex] || profits[profits.length-1];
        const ROI = (Final_Profit / P_buy) * 100; 
        const ROI_Year = (ROI / Days_to_sell) * 365; // –ü—Ä–∏–≤–µ–¥–µ–Ω–Ω–∞—è –≥–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å

        // 5. –í—ã–≤–æ–¥ —Ü–∏—Ñ—Ä
        document.getElementById('maxProfit').innerText = Math.round(Gross_Margin).toLocaleString() + ' ‚ÇΩ';
        document.getElementById('realProfit').innerText = Math.round(Final_Profit).toLocaleString() + ' ‚ÇΩ';
        document.getElementById('zeroPoint').innerText = (zeroDay || '>365') + ' –¥–Ω.';
        document.getElementById('roiYear').innerText = isFinite(ROI_Year) ? Math.round(ROI_Year) + '%' : '0%';

        // –ö—Ä–∞—Å–∏–º —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–∏–±—ã–ª—å
        const realProfitEl = document.getElementById('realProfit').parentElement;
        if(Final_Profit < 0) {
            realProfitEl.classList.remove('success');
            realProfitEl.classList.add('danger');
        } else {
            realProfitEl.classList.remove('danger');
            realProfitEl.classList.add('success');
        }

        // 6. –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫
        updateChart(days, profits, zeroDay, Days_to_sell);
    }

    function updateChart(labels, data, zeroX, sellX) {
        const ctx = document.getElementById('profitChart').getContext('2d');

        if (chartInstance) {
            chartInstance.destroy();
        }

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: '–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å (–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–º –∏—Ç–æ–≥–æ–º)',
                    data: data,
                    borderColor: '#2563EB',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    pointRadius: 0,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    annotation: {
                        annotations: {
                            line1: {
                                type: 'line',
                                yMin: 0,
                                yMax: 0,
                                borderColor: 'rgb(255, 99, 132)',
                                borderWidth: 2,
                            }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y.toLocaleString() + ' ‚ÇΩ';
                            }
                        }
                    }
                },
                scales: {
                    x: { 
                        title: { display: true, text: '–î–Ω–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏' },
                        grid: { display: false }
                    },
                    y: { 
                        title: { display: true, text: '–ü—Ä–∏–±—ã–ª—å, —Ä—É–±' },
                        grid: { color: '#f3f4f6' } 
                    }
                }
            }
        });
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    window.onload = calculate;
</script>

</body>
</html>
