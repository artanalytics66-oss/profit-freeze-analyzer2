<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profit Freeze Analyzer 2.0 | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #F0F2F5;
            --card-bg: #FFFFFF;
            --primary: #2563EB;
            --danger: #DC2626;
            --success: #10B981;
            --warning: #F59E0B;
            --text-main: #1F2937;
            --text-sec: #6B7280;
            --ai-bg: #F3E8FF;
            --ai-text: #6B21A8;
        }

        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; color: var(--text-main); }
        .container { max-width: 1400px; margin: 0 auto; display: grid; grid-template-columns: 350px 1fr 300px; gap: 24px; min-height: 90vh; }
        .card { background: var(--card-bg); border-radius: 16px; padding: 24px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; }
        
        h1 { font-size: 20px; font-weight: 700; margin-bottom: 24px; display: flex; align-items: center; gap: 10px; margin-top: 0; }
        h2 { font-size: 16px; font-weight: 600; color: var(--text-sec); margin-bottom: 16px; margin-top: 24px; border-bottom: 1px solid #E5E7EB; padding-bottom: 8px;}
        h2:first-child { margin-top: 0; }

        .input-group { margin-bottom: 16px; }
        .input-group label { display: block; font-size: 13px; color: var(--text-sec); margin-bottom: 6px; }
        .input-group input { width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px; box-sizing: border-box; }
        .input-group input:focus { border-color: var(--primary); outline: none; }

        .kpi-card { background: #F9FAFB; border-radius: 12px; padding: 16px; margin-bottom: 16px; text-align: center; border-left: 4px solid var(--primary); }
        .kpi-card.danger { border-left-color: var(--danger); background: #FEF2F2; }
        .kpi-card.success { border-left-color: var(--success); background: #ECFDF5; }
        .kpi-card.warning { border-left-color: var(--warning); background: #FFFBEB; }
        
        .kpi-value { font-size: 28px; font-weight: 800; display: block; margin: 8px 0; }
        .kpi-label { font-size: 11px; color: var(--text-sec); text-transform: uppercase; letter-spacing: 0.5px; }
        .kpi-sub { font-size: 12px; color: var(--text-sec); }

        .chart-container { position: relative; flex-grow: 1; min-height: 400px; display: flex; flex-direction: column; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .badge { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge-live { background: #DBEAFE; color: var(--primary); }

        /* AI –ë–ª–æ–∫ */
        .ai-advisor { margin-top: 20px; background: var(--ai-bg); border-radius: 12px; padding: 16px; border: 1px solid #D8B4FE; }
        .ai-title { color: var(--ai-text); font-weight: 700; font-size: 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .ai-content { font-size: 13px; line-height: 1.5; color: #4C1D95; }
        .ai-status-bad { color: var(--danger); font-weight: bold; }
        .ai-status-good { color: var(--success); font-weight: bold; }

        @media (max-width: 1024px) { .container { grid-template-columns: 1fr; height: auto; } }
    </style>
</head>
<body>

<div class="container">
    
    <!-- 1. –ü–ê–ù–ï–õ–¨ –í–í–û–î–ê -->
    <div class="card">
        <h1>‚ùÑÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –°–¥–µ–ª–∫–∏</h1>
        <h2>üì¶ –ü–∞—Ä—Ç–∏—è –∏ –ó–∞–∫—É–ø–∫–∞</h2>
        <div class="input-group"><label>–°—É–º–º–∞ –∑–∞–∫—É–ø–∫–∏, —Ä—É–±.</label><input type="number" id="purchaseCost" value="1000000" oninput="calculate()"></div>
        <div class="input-group"><label>–û–±—ä–µ–º –ø–∞—Ä—Ç–∏–∏ (–ø–∞–ª–ª–µ—Ç)</label><input type="number" id="pallets" value="10" oninput="calculate()"></div>
        <div class="input-group"><label>–û—Ç—Å—Ä–æ—á–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ (–¥–Ω–µ–π)</label><input type="number" id="deferment" value="14" oninput="calculate()"></div>

        <h2>üí∞ –ü—Ä–æ–¥–∞–∂–∏ –∏ –†—ã–Ω–æ–∫</h2>
        <div class="input-group"><label>–ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –Ω–∞—Ü–µ–Ω–∫–∞ (%)</label><input type="number" id="markupPercent" value="25" oninput="calculate()"></div>
        <div class="input-group"><label>–°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂ (–ø–∞–ª–ª–µ—Ç/–¥–µ–Ω—å)</label><input type="number" id="salesSpeed" value="0.3" step="0.1" oninput="calculate()"></div>

        <h2>üìâ –†–∞—Å—Ö–æ–¥—ã</h2>
        <div class="input-group"><label>–•—Ä–∞–Ω–µ–Ω–∏–µ (—Ä—É–±/–ø–∞–ª–ª–µ—Ç/—Å—É—Ç)</label><input type="number" id="storageCost" value="150" oninput="calculate()"></div>
        <div class="input-group"><label>–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–µ–Ω–µ–≥ (% –≥–æ–¥)</label><input type="number" id="moneyCost" value="22" oninput="calculate()"></div>
    </div>

    <!-- 2. –ì–†–ê–§–ò–ö + AI -->
    <div class="card">
        <div class="chart-header">
            <h1>–î–∏–Ω–∞–º–∏–∫–∞ "–¢–∞—è–Ω–∏—è" –ü—Ä–∏–±—ã–ª–∏</h1>
            <span class="badge badge-live">Live Simulation</span>
        </div>
        <div style="flex-grow: 1; position: relative;">
            <canvas id="profitChart"></canvas>
        </div>
        
        <!-- –ù–æ–≤—ã–π –±–ª–æ–∫ AI –°–æ–≤–µ—Ç–Ω–∏–∫–∞ -->
        <div class="ai-advisor">
            <div class="ai-title">üß† AI –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ê–Ω–∞–ª–∏–∑</div>
            <div class="ai-content" id="aiOutput">–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –¥–∞–Ω–Ω—ã–µ...</div>
        </div>
    </div>

    <!-- 3. –í–ï–†–î–ò–ö–¢ -->
    <div class="card">
        <h1>üéØ –í–µ—Ä–¥–∏–∫—Ç</h1>
        <div class="kpi-card success"><span class="kpi-label">–ú–∞–∫—Å. –ü—Ä–∏–±—ã–ª—å</span><span class="kpi-value" id="maxProfit">0 ‚ÇΩ</span></div>
        <div class="kpi-card"><span class="kpi-label">–†–µ–∞–ª—å–Ω–∞—è –ü—Ä–∏–±—ã–ª—å</span><span class="kpi-value" id="realProfit">0 ‚ÇΩ</span></div>
        <div class="kpi-card danger"><span class="kpi-label">–¢–æ—á–∫–∞ "–°–º–µ—Ä—Ç–∏"</span><span class="kpi-value" id="zeroPoint">0 –¥–Ω.</span></div>
        <div class="kpi-card"><span class="kpi-label">–≠—Ñ—Ñ. –≥–æ–¥–æ–≤—ã—Ö (ROI)</span><span class="kpi-value" id="roiYear">0%</span></div>
        <div class="kpi-card warning"><span class="kpi-label">–°—Ä–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏</span><span class="kpi-value" id="sellDays">0 –¥–Ω.</span></div>
    </div>

</div>

<script>
    let chartInstance = null;

    function calculate() {
        const P_buy = parseFloat(document.getElementById('purchaseCost').value) || 0;
        const Q_pallets = parseFloat(document.getElementById('pallets').value) || 1;
        const Deferment = parseFloat(document.getElementById('deferment').value) || 0;
        const Markup = parseFloat(document.getElementById('markupPercent').value) / 100;
        const Speed = parseFloat(document.getElementById('salesSpeed').value) || 0.1;
        const Cost_storage = parseFloat(document.getElementById('storageCost').value) || 0;
        const Rate_money = parseFloat(document.getElementById('moneyCost').value) / 100 / 365;

        const Gross_Margin = P_buy * Markup;
        const Days_to_sell = Q_pallets / Speed;

        const days = [];
        const profits = [];
        let zeroDay = null;

        let currentProfit = Gross_Margin;
        let totalCost = 0;

        for (let d = 0; d <= Math.max(Days_to_sell * 1.5, 90); d++) {
            let stock_remains = Math.max(0, Q_pallets - (d * Speed));
            let day_storage = stock_remains * Cost_storage;
            
            // –ï—Å–ª–∏ –æ—Å—Ç–∞—Ç–æ–∫ –¥–æ–ª–≥–∞ > 0 (–ø–æ—Å–ª–µ –æ—Ç—Å—Ä–æ—á–∫–∏)
            // –õ–æ–≥–∏–∫–∞ —É–ø—Ä–æ—â–µ–Ω–∞: —Å—á–∏—Ç–∞–µ–º –¥–µ–Ω—å–≥–∏ "–∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–º–∏" –≤ –æ—Å—Ç–∞—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞
            let money_frozen = (stock_remains / Q_pallets) * P_buy; 
            let day_money = (d > Deferment) ? money_frozen * Rate_money : 0;

            totalCost += (day_storage + day_money);
            currentProfit = Gross_Margin - totalCost;

            days.push(d);
            profits.push(currentProfit);

            if (currentProfit <= 0 && zeroDay === null) zeroDay = d;
        }

        const sellDayIndex = Math.min(Math.floor(Days_to_sell), days.length - 1);
        const Final_Profit = profits[sellDayIndex] || -totalCost;
        const ROI = (Final_Profit / P_buy) * 100;
        const ROI_Year = (ROI / Days_to_sell) * 365;

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—ã
        document.getElementById('maxProfit').innerText = Math.round(Gross_Margin).toLocaleString() + ' ‚ÇΩ';
        document.getElementById('realProfit').innerText = Math.round(Final_Profit).toLocaleString() + ' ‚ÇΩ';
        document.getElementById('zeroPoint').innerText = (zeroDay || '>365') + ' –¥–Ω.';
        document.getElementById('roiYear').innerText = isFinite(ROI_Year) ? Math.round(ROI_Year) + '%' : '0%';
        document.getElementById('sellDays').innerText = Math.round(Days_to_sell) + ' –¥–Ω.';

        // –¶–≤–µ—Ç–∞
        const rpCard = document.getElementById('realProfit').parentElement;
        rpCard.className = Final_Profit > 0 ? 'kpi-card success' : 'kpi-card danger';

        updateChart(days, profits, zeroDay);
        generateAIAdvice(Final_Profit, ROI_Year, Days_to_sell, Deferment, zeroDay);
    }

    function updateChart(labels, data, zeroX) {
        const ctx = document.getElementById('profitChart').getContext('2d');
        if (chartInstance) chartInstance.destroy();
        
        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: '–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å',
                    data: data,
                    borderColor: '#2563EB',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: {display: false}, annotation: { annotations: { line1: { type: 'line', yMin: 0, yMax: 0, borderColor: '#DC2626', borderWidth: 2 } } } },
                scales: { x: { grid: {display: false} }, y: { grid: {color: '#F3F4F6'} } }
            }
        });
    }

    function generateAIAdvice(profit, roi, daysSell, deferment, zeroDay) {
        const el = document.getElementById('aiOutput');
        let tips = [];
        let status = "neutral";

        // –õ–æ–≥–∏–∫–∞ "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞"
        if (profit < 0) {
            tips.push("‚õî <b>–°–¥–µ–ª–∫–∞ —É–±—ã—Ç–æ—á–Ω–∞!</b> –í—ã –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –¥–µ–Ω—å–≥–∏. –û—Ç–∫–∞–∂–∏—Ç–µ—Å—å –∏–ª–∏ —Ç—Ä–µ–±—É–π—Ç–µ —Å–∫–∏–¥–∫—É –Ω–∞ –∑–∞–∫—É–ø–∫—É.");
            status = "bad";
        } else if (roi < 20) {
            tips.push("‚ö†Ô∏è <b>–ù–∏–∑–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.</b> ROI " + Math.round(roi) + "% –≥–æ–¥–æ–≤—ã—Ö ‚Äî —ç—Ç–æ —É—Ä–æ–≤–µ–Ω—å –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –≤–∫–ª–∞–¥–∞. –†–∏—Å–∫ –Ω–µ –æ–ø—Ä–∞–≤–¥–∞–Ω.");
            status = "bad";
        } else {
            tips.push("‚úÖ <b>–•–æ—Ä–æ—à–∞—è —Å–¥–µ–ª–∫–∞.</b> –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞–ø–∏—Ç–∞–ª–∞ –≤—ã—Å–æ–∫–∞—è.");
            status = "good";
        }

        if (daysSell > deferment) {
            const gap = Math.round(daysSell - deferment);
            tips.push(`üìâ <b>–ö–∞—Å—Å–æ–≤—ã–π —Ä–∞–∑—Ä—ã–≤:</b> –í–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –ø–ª–∞—Ç–∏—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫—É –Ω–∞ ${gap} –¥–Ω–µ–π —Ä–∞–Ω—å—à–µ, —á–µ–º –≤—ã –ø—Ä–æ–¥–∞–¥–∏—Ç–µ —Ç–æ–≤–∞—Ä. –ò—â–∏—Ç–µ –¥–µ–Ω—å–≥–∏.`);
        } else {
            tips.push("üëç <b>–§–∏–Ω–∞–Ω—Å—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</b> –í—ã —É—Å–ø–µ–≤–∞–µ—Ç–µ –ø—Ä–æ–¥–∞—Ç—å —Ç–æ–≤–∞—Ä –¥–æ –æ–ø–ª–∞—Ç—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫—É.");
        }

        if (zeroDay && zeroDay < daysSell) {
            tips.push(`üî• <b>–ö—Ä–∏—Ç–∏—á–Ω–æ:</b> –¢–æ–≤–∞—Ä –Ω–∞—á–Ω–µ—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç—å —É–±—ã—Ç–∫–∏ —É–∂–µ –Ω–∞ ${zeroDay} –¥–µ–Ω—å, –∞ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –≤—ã –±—É–¥–µ—Ç–µ ${Math.round(daysSell)}. –£—Å–∫–æ—Ä—å—Ç–µ –ø—Ä–æ–¥–∞–∂–∏!`);
        }

        el.innerHTML = tips.join("<br><br>");
        el.className = "ai-content " + (status === "bad" ? "ai-status-bad" : "");
    }

    window.onload = calculate;
</script>

</body>
</html>

